<!DOCTYPE html>
<html lang="ml">

<head>
    <span id="headContainer"></span>
</head>

<body>
    <div class="loader" id="pageLoader">
        <div class="spinner"></div>
    </div>

    <span id="navbarContainer"></span>

    <section class="container py-3">
        <div class="index-card">
            <div class="chapter-header mb-3">
                <div class="chapter-name"></div>
                <div class="notranslate">
                    Chapter Number: <strong id="chapter-number"></strong> |
                    Total Hadith: <strong id="total-ayahs"></strong>
                </div>

                <div class="notranslate">
                    <a href="#" id="book-url" style="color: #4E2D45;">Chpters</a>
                </div>

                <div class="input-group mt-2 notranslate">
                    <input type="number" class="form-control" min="1" placeholder="Search hadith..."
                        id="hadith-number" />
                    <button type="button" class="btn btn-primary" onclick="searchHadithByNumber()">Go
                        To</button>
                </div>

                <div id="google_translate_element" class="mt-2 mb-0"></div>
            </div>

            <span id="chapter-ayahs"></span>
        </div>
    </section>

    <span id="footerContainer"></span>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/custom.js"></script>

    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'ml,en,hi,ar',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            },
                'google_translate_element'
            );
        }
    </script>
    <script type="text/javascript"
        src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const API_KEY = "$2y$10$B8yax3MxHEcXfplBYp94edFIjUBgKs05qwd08hZESA9C9NHtAwP6";
            let CHAPTER_NUMBER = '';

            const params = new URLSearchParams(window.location.search);
            const bookSlug = params.get("book");
            const chapterNumber = params.get("chapter");
            const hadithNumber = params.get("hadith");

            const input = document.getElementById("hadith-number");
            const bookUrlEl = document.getElementById("book-url");
            const chapterTitleEl = document.querySelector(".chapter-name");
            const chapterListEl = document.getElementById("chapter-ayahs");
            const totalAyahsEl = document.getElementById("total-ayahs");
            const chapterNumberEl = document.getElementById("chapter-number");
            const loader = document.getElementById("pageLoader");

            const bookLimits = {
                "sahih-bukhari": 7563,
                "sahih-muslim": 7563,
                "al-tirmidhi": 3955,
                "abu-dawood": 5274,
                "ibn-e-majah": 4341,
                "sunan-nasai": 5761,
                "mishkat": 6294
            };

            // Set input limit and placeholder
            if (bookLimits[bookSlug]) {
                input.max = bookLimits[bookSlug];
                input.placeholder = `Search hadith (1-${bookLimits[bookSlug]})`;
            } else {
                input.placeholder = "Search hadith...";
                return;
            }

            // Build request URL
            let url = `https://www.hadithapi.com/api/hadiths?apiKey=${API_KEY}&book=${bookSlug}`;
            if (chapterNumber) url += `&chapter=${chapterNumber}`;
            if (hadithNumber) {
                input.value = hadithNumber;
                url += `&hadithNumber=${hadithNumber}`;
            }

            // Update book URL
            bookUrlEl.href = `hadith-chapters.html?book=${bookSlug}`;

            // Fetch Hadiths
            fetch(url)
                .then(res => res.json())
                .then(response => {
                    if (response.status !== 200 || !response.hadiths?.data?.length) {
                        alert("Invalid hadith number. Please try again.");
                        return;
                    }

                    const hadiths = response.hadiths.data;
                    const { book, chapter } = hadiths[0];

                    // Update page content
                    bookUrlEl.textContent = book.bookName;
                    chapterTitleEl.textContent = `${chapter.chapterNumber} - ${chapter.chapterEnglish}`;
                    chapterNumberEl.textContent = chapter.chapterNumber;
                    totalAyahsEl.textContent = hadiths.length;
                    document.title = `${book.bookName} | ${chapter.chapterEnglish}`;

                    // Render Hadith cards
                    hadiths.forEach((hadith, index) => {
                        const card = document.createElement("div");
                        card.className = "ayah-card";

                        card.innerHTML = `                        
                        ${hadith.headingArabic ? `
                            <h6 class="ayah-arabic notranslate fw-bold hadith-text fs-5 m-0" style="line-height: 1.6">${hadith.headingArabic}</h6>
                            <h6 class="fw-bold fs-6">${hadith.headingEnglish}</h6>` : ''}

                        <div class="ayah-arabic notranslate hadith-text" style="font-size: 20px; line-height: 1.6">
                            ${hadith.hadithArabic}
                            <span class="fst-italic fs-6">(${index + 1})</span>
                        </div>

                        <div class="text-en">${hadith.hadithEnglish || "<em>No translation available</em>"}</div>

                        <p class="text-muted small notranslate mt-1 fst-italic">
                            ${hadith.book.bookName},
                            Volume: ${hadith.volume},
                            Chapter: #${hadith.chapter.chapterNumber} - ${hadith.chapter.chapterEnglish},
                            Hadith: #${hadith.hadithNumber},
                            Status: ${hadith.status || "Unknown"}
                        </p>
                    `;

                        chapterListEl.appendChild(card);
                    });

                    CHAPTER_NUMBER = chapter.chapterNumber;
                    if (loader) loader.style.display = "none";
                })
                .catch(err => {
                    alert("An error occurred while fetching data.");
                    if (loader) loader.style.display = "none";
                });

            // Global function
            window.searchHadithByNumber = function () {
                const number = parseInt(input.value);
                if (!number || number < 1) {
                    window.location.href = `hadith-view.html?book=${bookSlug}&chapter=${CHAPTER_NUMBER}`;
                    return;
                }

                window.location.href = `hadith-view.html?book=${bookSlug}&hadith=${number}`;
            };
        });
    </script>
</body>

</html>