<!DOCTYPE html>
<html lang="ml">

<head>
    <span id="headContainer"></span>
</head>

<body>
    <div class="loader" id="pageLoader">
        <div class="spinner"></div>
    </div>

    <span id="navbarContainer"></span>

    <header class="text-white text-center py-3">
        <div class="container">
            <h1 class="page-title"></h1>
            <p id="subtitle"></p>
            <nav aria-label="breadcrumb" class="custom-breadcrumb rounded p-2 mt-2">
                <ol class="breadcrumb justify-content-center mb-0">
                    <li class="breadcrumb-item"><a href="index.html" class="text-decoration-none">Home</a></li>
                    <li class="breadcrumb-item"><a href="life.html" class="text-decoration-none">Life</a></li>
                    <li class="breadcrumb-item active page-title text-muted" aria-current="page"></li>
                </ol>
            </nav>
        </div>
    </header>

    <main class="container py-3 col-two" id="contentList"></main>

    <span id="footerContainer"></span>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/custom.js"></script>

    <script type="module">
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD9CrCyr09c27TBi-yViwyk0l8HN340IHQ",
            authDomain: "isp-db-2330.firebaseapp.com",
            projectId: "isp-db-2330",
            storageBucket: "isp-db-2330.firebasestorage.app",
            messagingSenderId: "466666491726",
            appId: "1:466666491726:web:c5e9649793d8352465581f",
            measurementId: "G-CMDJLRF946"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            getDocs,
            query,
            where
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener("DOMContentLoaded", async () => {
            document.title = "Life of Muslim";

            const idParam = new URLSearchParams(window.location.search).get("id");
            const id = parseInt(idParam);
            const contentList = document.querySelector("#contentList");
            const loader = document.getElementById("pageLoader");

            if (!id || isNaN(id)) {
                contentList.innerHTML = `<div class="text-danger text-center">‡¥§‡µÜ‡¥±‡µç‡¥±‡¥æ‡¥Ø ID ‡¥≤‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡µÅ.</div>`;
                if (loader) loader.style.display = "none";
                return;
            }

            try {
                const q = query(collection(db, "life_of_muslim"), where("id", "==", id));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    contentList.innerHTML = `<div class="text-warning text-center">‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥≤‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡¥ø‡¥≤‡µç‡¥≤.</div>`;
                    return;
                }

                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const items = data.ml || [];

                    document.querySelectorAll(".page-title").forEach(el => el.textContent = data.ml_title);
                    document.querySelector("#subtitle").innerHTML = data.desc;
                    document.title = data.ml_title;

                    items.forEach((item, index) => {
                        const url = index == 0 ? `life-index.html` : `life-view.html?topic=${id}&id=${index + 1}`;
                        contentList.insertAdjacentHTML("beforeend", `
                            <div class="guide-card mb-2">
                            <a href="${url}" class="guide-title text-decoration-none">${index + 1} - ${item}</a>
                            <a href="${url}" class="view-btn">‚ûú</a>
                            </div>
                        `);
                    });
                });
            } catch (error) {
                console.error("üî• Error loading data:", error);
                contentList.innerHTML = `<div class="text-danger text-center">‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥®‡¥æ‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥ø‡¥≤‡µç‡¥≤.</div>`;
            } finally {
                if (loader) loader.style.display = "none";
            }
        });
    </script>

</body>

</html>