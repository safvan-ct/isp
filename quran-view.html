<!DOCTYPE html>
<html lang="ml">

<head>
    <span id="headContainer"></span>
</head>

<body>
    <div class="loader" id="pageLoader">
        <div class="spinner"></div>
    </div>

    <span id="navbarContainer"></span>

    <section class="container py-3">
        <div class="index-card">
            <div class="chapter-header mb-3">
                <div class="chapter-name"></div>
                <span id="translation-name"></span>
                <div>
                    Chapter: <strong id="chapter-number"></strong> |
                    Ayahs: <strong id="total-ayahs"></strong>
                </div>
            </div>

            <span id="chapter-verses"></span>
        </div>
    </section>

    <span id="footerContainer"></span>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/custom.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const chapterId = new URLSearchParams(window.location.search).get("chapter");

            const res = await fetch(`https://api.alquran.cloud/v1/surah/${chapterId}/editions/quran-uthman,ml.abdulhameed`); // ml.abdulhameed, en.asad, hi.hindi
            const result = await res.json();

            const arabicAyahs = result.data.filter(surah => surah.edition.language === "ar")[0].ayahs;
            const mlAyahs = result.data.filter(surah => surah.edition.language === "ml")[0].ayahs;

            const renderChapter = async () => {
                const chapterData = result.data[0];

                document.title = `${chapterData.englishName} | ${chapterData.name}`;
                document.querySelector(".chapter-name").textContent = `${chapterData.englishName} | ${chapterData.name}`;
                document.getElementById("translation-name").textContent = chapterData.englishNameTranslation;
                document.getElementById("chapter-number").textContent = toArabicNumber(chapterData.number);
                document.getElementById("total-ayahs").textContent = toArabicNumber(chapterData.numberOfAyahs);

                arabicAyahs.forEach((ayah) => {
                    const translation = mlAyahs.find((a) => a.numberInSurah === ayah.numberInSurah);

                    const html = `
                        <div class="ayah-card">
                            <div class="ayah-arabic">
                                <span class="quran-text">${ayah.text}</span>
                                <span class="ayah-number">${toArabicNumber(ayah.numberInSurah)}</span>
                            </div>
                            <div class="ayah-trans">${translation?.text || "<em>No Malayalam translation available</em>"}</div>
                        </div>
                    `;

                    document.getElementById("chapter-verses").insertAdjacentHTML("beforeend", html);

                    const loader = document.getElementById("pageLoader");
                    if (loader) loader.style.display = "none";
                });
            };

            renderChapter();
        });

        function toArabicNumber(number) {
            const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            return String(number).split('').map(d => arabicDigits[d]).join('');
        }
    </script>
</body>

</html>